# 篮球检测多线程与多帧融合开发记录

## 已完成工作

- [x] 主线程与篮球检测线程分离，采用异步推理，充分利用多核 NPU。
- [x] 主线程完成 undistort/resize 后，将图像送入篮球检测线程的安全队列。
- [x] 篮球检测线程独立加载模型，分配到不同 NPU，循环取帧推理。
- [x] 检测到篮球后，将检测结果（结构体）推送到主线程结果队列。
- [x] 主线程每帧取出最新检测结果，完成画框和 debug 输出。
- [x] 关键流程均有详细注释和调试信息。

## 关键实现点

- 使用 `std::queue` + `std::mutex` + `std::condition_variable` 实现线程安全队列。
- 检测结果结构体 `BasketballDetectResult`，包含框、置信度、时间戳。
- 检测队列和结果队列均有限长，防止内存堆积。
- 主线程和检测线程完全解耦，互不阻塞。

## 调试要点

- 每帧送入/取出队列均有 debug 信息，便于定位性能瓶颈。
- 检测框坐标已做尺寸映射，画面显示准确。
- 检测线程异常退出、模型加载失败等均有详细提示。

## TODO：多帧融合（Multi-frame Fusion）

- [ ] 设计多帧融合策略（如：滑动窗口平均、置信度投票、连续帧确认、轨迹跟踪等）。
- [ ] 在主线程或检测线程中缓存最近 N 帧检测结果。
- [ ] 实现去抖动、误检过滤、轨迹平滑等功能。
- [ ] 结合 BYTETrack 等跟踪算法，提升目标一致性。
- [ ] 增加融合后结果的可视化与 debug 输出。

---

> 如需实现具体的多帧融合方式，请补充需求细节。 